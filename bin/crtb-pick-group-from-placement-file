#!/usr/bin/env raku
use App::Classroom::Toolbox;
use JSON::Fast;
use Terminal::ANSIColor;

sub MAIN (IO(Str) :$placement-file?, UInt :$group-size = 1) {
    without $placement-file {
        without %*ENV<CRTB_PLACEMENT> {
            die "parameter --placement-file=/path/to/placement-file or environment variable CRTB_PLACEMENT required. E.g. 'export CRTB_PLACEMENT=placements/demo-placement'"
        }
        with %*ENV<CRTB_PLACEMENT> {
            die %*ENV<CRTB_PLACEMENT> ~ " not found" unless %*ENV<CRTB_PLACEMENT>.IO.f;
        }
    }
    with $placement-file {
        die "$placement-file not found" unless $placement-file.f;
    }

    my @room = from-json ($placement-file || %*ENV<CRTB_PLACEMENT>.IO).slurp;
    my @students = flat @room.map: *.grep(/\w../);
    my @highlighted = @students.pick($group-size);
    my Str $out = create-teacher-view(@room);
    for @highlighted -> $name {
        my $colored = colored($name, 'red on_blue');
        $out ~~ s/$name/$colored/
    }
    say $out
}