#!/usr/bin/env raku
use App::Classroom::Toolbox;
use JSON::Fast;
use Terminal::ANSIColor;

sub MAIN (IO(Str) :p(:$placement-file) where *.IO.f = %*ENV<CRTB_PLACEMENT_FILE>, #= file containing placement; --placement-file=placements/demo-placement or 'export CRTB_PLACEMENT_FILE=placements/demo-placement'
          UInt    :g(:$group-size)     where * > 0  = %*ENV<CRTB_GROUP_SIZE>      #= size of group to pick; 'export CRTB_GROUP_SIZE=1'
          ) {

    my @room = from-json $placement-file.slurp;
    my @students = flat @room.map: *.grep(/\w../);
    my @highlighted = @students.pick($group-size);
    my Str $out = create-teacher-view(@room);
    for @highlighted -> $name {
        my $colored = colored($name, 'red on_blue');
        $out ~~ s/$name/$colored/
    }
    say $out
}